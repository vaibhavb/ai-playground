<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Neural Exercise Maker</title>
  <style>
    :root {
      --bg: #050914;
      --bg-alt: #0d1526;
      --panel: #101a30;
      --panel-alt: #151f38;
      --accent: #ffb454;
      --accent-soft: rgba(255, 180, 84, 0.2);
      --text-main: #f5f5f5;
      --text-muted: #9ca8cc;
      --error: #ff6b81;
      --success: #5fd7a6;
      --border-subtle: #28324a;
      --shadow-soft: 0 24px 80px rgba(0, 0, 0, 0.6);
      --radius-lg: 18px;
      --radius-sm: 10px;
      --transition-fast: 0.2s ease-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: "Fira Code", "Menlo", "SF Mono", monospace;
      background:
        radial-gradient(circle at 0% 0%, rgba(255, 180, 84, 0.12), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(95, 215, 166, 0.1), transparent 55%),
        linear-gradient(135deg, #02040a 0%, #050914 45%, #02040a 100%);
      color: var(--text-main);
      padding: 28px 32px 40px;
      display: flex;
      flex-direction: column;
      gap: 22px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    h1 {
      font-size: 24px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      font-weight: 600;
    }

    .tagline {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--text-muted);
    }

    .badge {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(3, 9, 25, 0.9);
      backdrop-filter: blur(16px);
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(255, 180, 84, 0.9);
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.1fr);
      gap: 22px;
      align-items: stretch;
    }

    .panel {
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.03), transparent 55%),
                  radial-gradient(circle at 100% 100%, rgba(255, 255, 255, 0.02), transparent 55%),
                  linear-gradient(145deg, rgba(9, 15, 36, 0.98), rgba(8, 14, 32, 0.96));
      border-radius: var(--radius-lg);
      padding: 16px 18px 18px;
      border: 1px solid rgba(255, 255, 255, 0.04);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.04) 0, transparent 60%),
                        radial-gradient(circle at 100% 100%, rgba(0, 0, 0, 0.65) 0, transparent 65%);
      opacity: 0.7;
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      z-index: 1;
    }

    .panel-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    .panel-sub {
      font-size: 11px;
      color: var(--text-muted);
      opacity: 0.8;
    }

    .chip-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 2px;
    }

    .chip {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: var(--text-muted);
      background: rgba(5, 9, 22, 0.85);
    }

    textarea {
      width: 100%;
      min-height: 140px;
      max-height: 260px;
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.05), transparent 60%),
                  radial-gradient(circle at 100% 100%, rgba(0, 0, 0, 0.75), transparent 65%);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-subtle);
      padding: 11px 12px;
      color: var(--text-main);
      font-family: "Fira Code", "Menlo", monospace;
      font-size: 12px;
      resize: vertical;
      outline: none;
      position: relative;
      z-index: 1;
    }

    textarea::placeholder {
      color: rgba(156, 168, 204, 0.55);
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(255, 180, 84, 0.3), 0 0 40px rgba(255, 180, 84, 0.26);
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.06), transparent 60%),
                  radial-gradient(circle at 100% 100%, rgba(0, 0, 0, 0.8), transparent 65%);
    }

    .controls {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding-top: 4px;
      position: relative;
      z-index: 1;
    }

    button {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 7px 16px;
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      cursor: pointer;
      background: radial-gradient(circle at 0 0, rgba(255, 180, 84, 0.18), transparent 55%),
                  linear-gradient(120deg, #ffb454 0%, #ff8f40 40%, #ffd16e 100%);
      color: #201106;
      font-weight: 600;
      box-shadow: 0 14px 35px rgba(0, 0, 0, 0.85);
      transform: translateY(0);
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        filter var(--transition-fast),
        background-position 0.3s ease-out;
      background-size: 180% 180%;
      background-position: 0% 50%;
    }

    button.secondary {
      background: rgba(4, 10, 28, 0.9);
      color: var(--text-muted);
      border-color: rgba(255, 255, 255, 0.12);
      box-shadow: 0 8px 26px rgba(0, 0, 0, 0.7);
      text-transform: none;
      letter-spacing: 0.08em;
      font-size: 11px;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.95);
      filter: brightness(1.02);
      background-position: 100% 50%;
    }

    button:active {
      transform: translateY(1px);
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.9);
      filter: brightness(0.98);
    }

    .exercise-shell {
      position: relative;
      z-index: 1;
      background: linear-gradient(145deg, var(--panel), var(--panel-alt));
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-subtle);
      padding: 13px 14px 14px;
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.4);
      min-height: 160px;
      overflow: auto;
    }

    .exercise-header-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .exercise-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--text-muted);
    }

    .status-pill {
      font-size: 10px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(3, 9, 25, 0.9);
      color: var(--text-muted);
    }

    .status-pill.ready {
      border-color: var(--accent);
      color: var(--accent);
      background: var(--accent-soft);
    }

    .markdown {
      font-size: 13px;
      line-height: 1.5;
      color: var(--text-main);
    }

    .markdown h1,
    .markdown h2,
    .markdown h3 {
      margin: 8px 0 4px;
      font-weight: 600;
    }

    .markdown h1 { font-size: 17px; }
    .markdown h2 { font-size: 15px; }
    .markdown h3 { font-size: 14px; }

    .markdown p {
      margin: 4px 0;
    }

    .markdown ul,
    .markdown ol {
      margin: 4px 0 4px 18px;
      padding-left: 12px;
    }

    .markdown code {
      background: rgba(3, 9, 25, 0.9);
      padding: 1px 4px;
      border-radius: 4px;
      font-size: 11px;
    }

    .answer-input {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      padding: 3px 8px;
      font-size: 12px;
      font-family: "Fira Code", "Menlo", monospace;
      background: rgba(4, 9, 24, 0.95);
      color: var(--text-main);
      min-width: 72px;
      outline: none;
    }

    .answer-input.correct {
      border-color: var(--success);
      box-shadow: 0 0 0 1px rgba(95, 215, 166, 0.55);
      background: radial-gradient(circle at 0 0, rgba(95, 215, 166, 0.16), transparent 60%);
    }

    .answer-input.incorrect {
      border-color: var(--error);
      box-shadow: 0 0 0 1px rgba(255, 107, 129, 0.55);
      background: radial-gradient(circle at 0 0, rgba(255, 107, 129, 0.15), transparent 60%);
    }

    .feedback {
      font-size: 11px;
      margin-top: 6px;
      color: var(--text-muted);
    }

    .feedback strong {
      font-weight: 600;
    }

    .feedback.ok { color: var(--success); }
    .feedback.bad { color: var(--error); }

    .legend {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .legend code {
      font-size: 10px;
    }

    .hint-area {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px dashed rgba(255, 255, 255, 0.08);
      font-size: 11px;
      color: var(--text-muted);
    }

    .hint-content {
      margin-top: 6px;
      font-size: 12px;
      line-height: 1.5;
    }

    .hint-content pre {
      background: rgba(3, 9, 22, 0.95);
      border-radius: 8px;
      padding: 8px 10px;
      overflow: auto;
      font-size: 11px;
    }

    @media (max-width: 960px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="title-block">
      <h1>Neural Exercise Studio</h1>
      <div class="tagline">Markdown → Interactive neural network drills</div>
    </div>
    <div class="badge">
      <span class="badge-dot"></span>
      <span>author mode</span>
    </div>
  </header>

  <main>
    <section class="panel">
      <div class="panel-header">
        <div>
          <div class="panel-title">Author Workspace</div>
          <div class="panel-sub">Write your exercise and solved example in Markdown.</div>
        </div>
      </div>

      <div class="chip-row">
        <div class="chip">Use <code>[[id]]</code> for blanks in the exercise.</div>
        <div class="chip">Use <code>[[id:correct]]</code> in the solution.</div>
      </div>

      <div style="display:flex; gap:10px; margin-top:8px;">
        <div style="flex:1; display:flex; flex-direction:column; gap:4px;">
          <span class="panel-sub">Exercise (Markdown)</span>
          <textarea id="exerciseInput" placeholder="# Example: ReLU neuron
Given inputs X₁ = 3, X₂ = 1.

Weights: w₁ = 1, w₂ = 1, bias b = -5.

Compute the linear output y and then ReLU(y).

Final answer: y = [[y]], ReLU(y) = [[relu_y]]"></textarea>
        </div>
        <div style="flex:1; display:flex; flex-direction:column; gap:4px;">
          <span class="panel-sub">Solved Example (Markdown)</span>
          <textarea id="solutionInput" placeholder="# Solution
y = 3·1 + 1·1 − 5 = -1

ReLU(y) = 0

Final answer: y = [[y:-1]], ReLU(y) = [[relu_y:0]]"></textarea>
        </div>
      </div>

      <div class="controls">
        <button id="loadExampleBtn" class="secondary" type="button">Load ReLU demo</button>
        <button id="buildBtn" type="button">Build Interactive Exercise</button>
      </div>
    </section>

    <section class="panel">
      <div class="panel-header">
        <div>
          <div class="panel-title">Learner View</div>
          <div class="panel-sub">What your students will see and interact with.</div>
        </div>
      </div>

      <div class="exercise-shell">
        <div class="exercise-header-row">
          <div class="exercise-label">Exercise</div>
          <div id="statusPill" class="status-pill">Waiting for exercise…</div>
        </div>
        <div id="exerciseRender" class="markdown">
          <p>Click <strong>Build Interactive Exercise</strong> to generate the question UI.</p>
        </div>
        <div class="feedback" id="feedback"></div>
        <div class="legend">
          Author syntax:
          <code>[[z]]</code> → blank in exercise,
          <code>[[z:-1]]</code> → correct value in solution.
        </div>
        <div class="hint-area">
          <button id="toggleHintBtn" class="secondary" type="button">Show worked solution</button>
          <div id="hintContent" class="hint-content" style="display:none;"></div>
        </div>
      </div>

      <div class="controls">
        <button id="checkBtn" type="button">Check Answers</button>
        <button id="resetBtn" class="secondary" type="button">Clear Inputs</button>
      </div>
    </section>
  </main>

  <script>
    // Tiny markdown renderer for headings, lists, emphasis, and code.
    function renderMarkdown(md) {
      let html = md;

      html = html.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

      html = html.replace(/^### (.*)$/gm, "<h3>$1</h3>");
      html = html.replace(/^## (.*)$/gm, "<h2>$1</h2>");
      html = html.replace(/^# (.*)$/gm, "<h1>$1</h1>");

      html = html.replace(/`([^`]+)`/g, "<code>$1</code>");
      html = html.replace(/\*\*([^*]+)\*\*/g, "<strong>$1</strong>");
      html = html.replace(/\*([^*]+)\*/g, "<em>$1</em>");

      html = html.replace(/^- (.*)$/gm, "<li>$1</li>");
      html = html.replace(/(<li>.*<\/li>)/gs, "<ul>$1</ul>");

      html = html.replace(/^(?!<h1|<h2|<h3|<ul|<li|<p|<code|<strong|<em|<pre|<\/ul|<\/li)(.+)$/gm, "<p>$1</p>");

      return html;
    }

    function extractAnswers(solutionMd) {
      // Matches [[id:value]] pairs and returns { id: value }
      const answerMap = {};
      const pattern = /\[\[([a-zA-Z0-9_\-]+):(.*?)\]\]/g;
      let match;
      while ((match = pattern.exec(solutionMd)) !== null) {
        const id = match[1].trim();
        const value = match[2].trim();
        answerMap[id] = value;
      }
      return answerMap;
    }

    function injectInputs(exerciseMd) {
      // Replace [[id]] in exercise markdown with <input> fields
      const pattern = /\[\[([a-zA-Z0-9_\-]+)\]\]/g;
      const withInputs = exerciseMd.replace(pattern, (full, id) => {
        const safeId = id.trim();
        return `<input class="answer-input" data-answer-id="${safeId}" />`;
      });
      return withInputs;
    }

    function numericCompare(a, b) {
      const na = Number(a);
      const nb = Number(b);
      if (!Number.isFinite(na) || !Number.isFinite(nb)) {
        return a.trim() === b.trim();
      }
      const tol = 1e-6;
      return Math.abs(na - nb) <= tol;
    }

    const exerciseInput = document.getElementById("exerciseInput");
    const solutionInput = document.getElementById("solutionInput");
    const buildBtn = document.getElementById("buildBtn");
    const loadExampleBtn = document.getElementById("loadExampleBtn");
    const exerciseRender = document.getElementById("exerciseRender");
    const statusPill = document.getElementById("statusPill");
    const feedback = document.getElementById("feedback");
    const checkBtn = document.getElementById("checkBtn");
    const resetBtn = document.getElementById("resetBtn");
    const toggleHintBtn = document.getElementById("toggleHintBtn");
    const hintContent = document.getElementById("hintContent");

    let compiledAnswers = {};
    let compiledSolutionHtml = "";

    buildBtn.addEventListener("click", () => {
      const exerciseMd = exerciseInput.value.trim();
      const solutionMd = solutionInput.value.trim();

if (!exerciseMd || !solutionMd) {
        feedback.textContent = "Please provide both exercise and solution Markdown.";
        feedback.className = "feedback bad";
        return;
      }

      compiledAnswers = extractAnswers(solutionMd);
      // First render markdown, then inject inputs into the HTML
      const rendered = renderMarkdown(exerciseMd);
      const htmlWithInputs = injectInputs(rendered);

      exerciseRender.innerHTML = htmlWithInputs;
      statusPill.textContent = "Ready";
      statusPill.classList.add("ready");
      feedback.textContent = "Exercise generated. Fill in the blanks and press Check Answers.";
      feedback.className = "feedback";

      compiledSolutionHtml = renderMarkdown(solutionMd);
      hintContent.innerHTML = compiledSolutionHtml;
    });

    checkBtn.addEventListener("click", () => {
      const inputs = exerciseRender.querySelectorAll(".answer-input");
      if (!inputs.length) {
        feedback.textContent = "No blanks found. Did you use [[id]] in the exercise Markdown?";
        feedback.className = "feedback bad";
        return;
      }

      let total = 0;
      let correctCount = 0;
      let missingIds = [];
      inputs.forEach((input) => {
        const id = input.dataset.answerId;
        const expected = compiledAnswers[id];
        total += 1;

        input.classList.remove("correct", "incorrect");

        if (expected === undefined) {
          missingIds.push(id);
          return;
        }

        const given = input.value.trim();
        if (given === "") {
          input.classList.add("incorrect");
          return;
        }

        const ok = numericCompare(given, expected);
        if (ok) {
          input.classList.add("correct");
          correctCount += 1;
        } else {
          input.classList.add("incorrect");
        }
      });

      if (missingIds.length) {
        feedback.textContent =
          "Some blanks are missing in the solution mapping: " +
          [...new Set(missingIds)].join(", ") +
          ". Add [[id:value]] entries to the solution.";
        feedback.className = "feedback bad";
        return;
      }

      if (!total) {
        feedback.textContent = "No interactive blanks to check.";
        feedback.className = "feedback bad";
        return;
      }

      if (correctCount === total) {
        feedback.textContent = `All ${total} answers are correct.`;
        feedback.className = "feedback ok";
      } else {
        feedback.textContent = `Correct: ${correctCount}/${total}. Incorrect answers are highlighted.`;
        feedback.className = "feedback bad";
      }
    });

    resetBtn.addEventListener("click", () => {
      const inputs = exerciseRender.querySelectorAll(".answer-input");
      inputs.forEach((input) => {
        input.value = "";
        input.classList.remove("correct", "incorrect");
      });
      feedback.textContent = "";
      feedback.className = "feedback";
    });

    toggleHintBtn.addEventListener("click", () => {
      const visible = hintContent.style.display !== "none";
      if (visible) {
        hintContent.style.display = "none";
        toggleHintBtn.textContent = "Show worked solution";
      } else {
        hintContent.style.display = "block";
        toggleHintBtn.textContent = "Hide worked solution";
      }
    });

    loadExampleBtn.addEventListener("click", () => {
      const defaultExercise = `# ReLU neuron by hand

We have a single neuron with inputs:

- X₁ = 3  
- X₂ = 1  

Weights and bias:

- w₁ = 1  
- w₂ = 1  
- b = -5  

1. Compute the linear output  

   \`y = w₁·X₁ + w₂·X₂ + b\`

2. Apply ReLU  

   \`ReLU(y) = max(0, y)\`

Final numeric answers:

- y = [[y]]
- ReLU(y) = [[relu_y]]`;

      const defaultSolution = `# Solution – ReLU neuron

Linear output:

\`y = 1·3 + 1·1 - 5 = -1\`

ReLU activation:

\`ReLU(y) = max(0, -1) = 0\`

Final numeric answers:

- y = [[y:-1]]
- ReLU(y) = [[relu_y:0]]`;

      exerciseInput.value = defaultExercise;
      solutionInput.value = defaultSolution;
      feedback.textContent = "Loaded sample ReLU neuron. Click Build Interactive Exercise.";
      feedback.className = "feedback";
    });
  </script>
</body>
</html>

